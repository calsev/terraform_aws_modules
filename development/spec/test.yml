version: 0.2
phases:
  install:
    commands:
      - apt-get update
      - apt-get install -yqq git gnupg2 make software-properties-common wget
      - wget -O- https://apt.releases.hashicorp.com/gpg | 
        gpg --dearmor | 
        sudo tee /usr/share/keyrings/hashicorp-archive-keyring.gpg
      - gpg --no-default-keyring 
        --keyring /usr/share/keyrings/hashicorp-archive-keyring.gpg 
        --fingerprint
      - echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" > 
        /etc/apt/sources.list.d/hashicorp.list
      - apt-get update
      - apt-get install terraform
      - terraform --version
      - cd development
      - export BASE_PY=$(which python)
      - make env-install
  build:
    commands:
      # Check that Makefile has been updated
      - make make
      - git diff --exit-code
      # Lint scripts and modules
      - make py-lint
      - make tf-lint
artifacts:
  base-directory: app/public
  files:
    - '**/*'
